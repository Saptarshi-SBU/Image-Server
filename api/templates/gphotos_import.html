<!DOCTYPE html>
<html>
<body>

<div class="header">
    <span align="center">
        <h2>
            My GooglePhotos Syncer
           <a style="font-size: 16px;" href="http://$SERVER_HOST_IP:4040/api/v1/myalbum?img=My Google Photos">&#x23fa</a> 
           <a style="font-size: 16px;" href="http://$SERVER_HOST_IP:4040/api/v1/gauto">&#x2615 </a>
           <input type="button" style="height:16px;width:32px;font-size:16px;color:blue;background-color:Transparent;border:None;cursor:pointer" value=&#x1F308 onclick="process_album()"></input>
        </h2>
    </span>
</div>

<form>
  <a href="http://$SERVER_HOST_IP:4040/api/v1/import" target="_blank">Click to Authorize</a><br><br>
  <label for="name"> Refresh Token:</label><br>
  <input type="text" id="token" value=""><br><br></input>
  <input type="submit" style="height:24px;width:64px;font-size:14px;color:blue;" value="Submit" onclick="run_import()"><br><br></input>
  <label for="file">Download progress:</label>
	<progress id="progressbar" value="0" max="100"> 0% </progress>
</form> 

<script>

var album_name = "My Google Photos"
function run_import() {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
		    console.log("running sync photos");
        } else {
            console.log("sync status :" + this.status);
            console.log("readyState :"  + this.readyState);
        }
    };
    xmlhttp.onerror = function (e) {
        console.error(xmlhttp.statusText);
    };
    elem = document.getElementById("token");
    xmlhttp.open("POST", 'http://$SERVER_HOST_IP:4040/api/v1/import', true);
    xmlhttp.send(elem.value);
    console.log(elem.value)
}

function process_album() {
    var xmlhttp  = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
            console.log('\nlog: process album')
        }
    };
    xmlhttp.open("POST", 'http://$SERVER_HOST_IP:4040/api/v1/enhancealbum');
    xmlhttp.send(album_name);
}

var source = new EventSource('http://$SERVER_HOST_IP:4040/api/v1/importstatus');
source.onmessage = function(event) {
    elem = document.getElementById("progressbar")
    console.log("new message :", event.data)
    elem.value = event.data
    if(event.data == 100){
        source.close()
    }
}

</script>
</body>
</html>
